import express from 'express';
import http from 'http';
import { Server } from "socket.io";
import { createServer} from 'http';
import WebSocket from 'ws'
import jimp from 'jimp'
//import sleep from 'sleep'

function generateImage(request, socket){
	// make websocket request to api.hallucinate.app and get the image
	console.log("Generating image")
	console.log(request)
	let test = {
		"prompt": "test",
		"iterations": 1,
		"steps": 50,
		"cfg_scale": 7.5,
		"threshold": 0,
		"perlin": 0,
		"height": 512,
		"width": 512,
		"sampler_name": "k_lms",
		"seed": 1496138410,
		"progress_images": false,
		"progress_latents": true,
		"save_intermediates": 5,
		"generation_mode": "unifiedCanvas",
		"init_mask": "data:image/png;base64,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CJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8g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oIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBB40W/6ahZLM0wAAAAASUVORK5CYII=",
		"fit": false,
		"strength": 0.75,
		"invert_mask": false,
		"bounding_box": {
		  "x": 0,
		  "y": 0,
		  "width": 512,
		  "height": 512
		},
		"init_img": "data:image/png;base64,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MACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAIEH9IYCAbVe32sAAAAASUVORK5CYII=",
		"inpaint_width": 512,
		"inpaint_height": 512,
		"seam_size": 96,
		"seam_blur": 16,
		"seam_strength": 0.7,
		"seam_steps": 30,
		"tile_size": 32,
		"infill_method": "patchmatch",
		"force_outpaint": false,
		"variation_amount": 0
	}
	let task = {
		 "task": {
			"model": 'stable-diffusion-v1.5',
			"prompt": request["prompt"],
			"width": request["width"],
			"height": request["height"],
			"sampler_name": 'k',
			"sampler_args": {
				"schedule": 'lms'
			},
			"cfg_scale": request["cfg_scale"],
			"denoising_strength": request["strength"],
			"steps": request["steps"],
			"seed": request["seed"],
			"timestamp": Date.now()
		},
	"context": request["init_img"]
	}

	let task2 = {
		"command": "diffuse",
		"model": 'stable-diffusion-v1.5',
		"prompt": request["prompt"],
		"width": request["width"],
		"height": request["height"],
		"sampler_name": 'k',
		"sampler_args": {
			"schedule": 'lms'
		},
		"cfg_scale": request["cfg_scale"],
		"denoising_strength": request["strength"],
		"steps": request["steps"],
		"seed": request["seed"],
		"timestamp": Date.now(),
		"input_image": request["init_img"],
		"mask_image": request["init_mask"],
	}


	const  HallucinateAPI = new WebSocket('wss://api.hallucinate.app?version=7.0')
	//const send = task2 => ws.send(JSON.stringify(task2))
	const send = task => HallucinateAPI.send(JSON.stringify(task))

	HallucinateAPI.on('open', () => {
		let expectedBytes
		
		console.log('connection accepted')
		
		HallucinateAPI.on('message', raw => {
			let { event, ...payload } = JSON.parse(raw)
	
			switch (event) {
				case 'queue':
					console.log('position in queue is:', payload.position)
					break
				
				case 'progress':
					console.log(
						'progress:', 
						payload.stage, 
						payload.value
							? `${Math.round(payload.value * 100)}%`
							: ``
					)
					break
	
				case 'error':
					console.log('error:', payload.message)
					break
	
				case 'result':
					if (fs.existsSync('output.jpg'))
						fs.unlinkSync('output.jpg')
	
					expectedBytes = payload.length
					console.log('compute finished: expecting', expectedBytes, 'bytes')
					break
	
				case 'chunk':
					let blob = Buffer.from(payload.blob, 'base64')
	
					fs.appendFileSync('output.jpg', blob)
					expectedBytes -= blob.length
	
					console.log('received bytes:', expectedBytes, 'to go')
	
					if(expectedBytes <= 0){
						console.log('done')
						process.exit()
					}
	
					break
	
			}
		})
	
		if(context){
			send({
				command: 'upload_image',
				id: 'ctx',
				blob: context.toString('base64')
			})
			console.log('sent context')
		}
	
		if(mask){
			send({
				command: 'upload_image',
				id: 'mask',
				blob: mask.toString('base64')
			})
			console.log('sent mask')
		}
	
	
		send({
			...task,
			command: 'diffuse',
			id: 'task',
			input_image: context ? 'ctx' : undefined,
			mask_image: mask ? 'mask' : undefined,
		})
	
		console.log('sent task:', task)
	})
	
	HallucinateAPI.on('close', code => {
		console.log('socket closed: code', code)
	})




	if (request["init_img"] != "" && request["init_mask"] != ""){
		//save init_img and init_mask to disk
		
	}
	//check status of websocket
	
	//while (HallucinateAPI.readyState != 1) {
	//	console.log("waiting for connection")
	//	console.log(HallucinateAPI.readyState)
	//	console.log(HallucinateAPI.CONNECTING)
	//	await new Promise(resolve => setTimeout(resolve, 100));	
	//}

	//HallucinateAPI.on('open', function open() {
	//	HallucinateAPI.send(JSON.stringify(task2))
	//	console.log("sent")
	//	console.log(task2)
	//
	//})
	
	//HallucinateAPI.on('error', function error(event) {
	//	console.log("error")
	//	console.log(event)
	//})

	//let output = undefined
	//HallucinateAPI.on('message', function message(event) {
	//	console.log("message")
	//	console.log(event)
	//	let { requestEvent, ...requestPayload } = JSON.parse(event.data)
	//	if (requestEvent == "progress") {
	//		console.log("progress")
	//		console.log(requestPayload)
	//		let update = {
	//			"currentStep": 50,
	//			"totalSteps": 37,
	//			"currentIteration": 1,
	//			"totalIterations": 1,
	//			"currentStatus": "common:statusSavingImage",
	//			"isProcessing": true,
	//			"currentStatusHasSteps": true,
	//			"hasError": false
	//		  }
	//		socket.emit('progressUpdate', update)
	//	}
	//	if (requestEvent == "result") {
	//		console.log("result")
	//		console.log(requestPayload)

			let output = {
				"url": "outputs/temp-images/000018.fdec8761.4028965222.png",
				"thumbnail": "outputs/thumbnails/000018.fdec8761.4028965222.webp",
				"mtime": 1676801456.6904244,
				"metadata": {
				  "model": "stable diffusion",
				  "model_weights": "stable-diffusion-1.5",
				  "model_hash": "cc6cb27103417325ff94f52b7a5d2dde45a7515b25c255d8e396c90014281516",
				  "app_id": "invoke-ai/InvokeAI",
				  "app_version": "2.2.5",
				  "image": {
					"prompt": [
					  {
						"prompt": "a dog on a coin",
						"weight": 1
					  }
					],
					"steps": 50,
					"cfg_scale": 7.5,
					"threshold": 0,
					"perlin": 0,
					"height": 512,
					"width": 512,
					"seed": 4028965222,
					"type": "unifiedCanvas",
					"postprocessing": null,
					"sampler": "k_lms",
					"variations": []
				  }
				},
				"dreamPrompt": "\"a dog on a coin\" -s 50 -S 4028965222 -W 512 -H 512 -C 7.5 -A k_lms",
				"width": 512,
				"height": 512,
				"boundingBox": {
				  "x": 0,
				  "y": 0,
				  "width": 512,
				  "height": 512
				},
				"generationMode": "unifiedCanvas",
				"attentionMaps": "data:image/png;base64,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",
				"tokens": [
				  "a</w>",
				  "dog</w>",
				  "on</w>",
				  "a</w>",
				  "coin</w>"
				]
			}
			// wait 5 seconds before returning output 
			//setTimeout(() => {
			//	return output
			//}, 5000)
			//return output
		//}
		//if (requestEvent == "error") {
		//	console.log("error")
		//	console.log(requestPayload)
		//}
		//if (requestEvent == "chunk"){
		//	console.log("chunk")
		//	console.log(requestPayload)
		//}
	//});
	while (output == undefined){
		setInterval(() => {
			console.log("waiting for output")
		}
		, 10000);
	}
}

const app = express();
const server = createServer(app);
var socketio = new Server(server);

app.get('/', function (req, res) {
	res.send()
});

app.get('/outputs', (req, res) => {

});

app.get('/socket.io', (req, res) => {
	//res.send('Hello World!');
	if (req.query.EIO == 4 && req.query.transport == 'polling' && req.query.t != null && req.query.sid == null){
		// create session ID
		let sid = sha1(req.query.t).substring(0,20)
		//set cookies for session ID
		res.cookie('sid', sid)
		let response = [{"sid":sid,"upgrades":["websocket"],"pingTimeout":60000,"pingInterval":100000}]
		res.send(response)
	}
	else if (req.query.EIO == 4 && req.query.transport == 'polling' && req.query.t != null && req.query.sid != null){
		let response = "OK"
		res.send(response)		
	}
	else if (req.query.EIO == 4 && req.query.transport == 'websocket' && req.query.sid != null){
		//startWebsocket(true)
	}		
	// shut down the express server
});

app.get('/upload', (req, res) => {

});

app.get('/flaskwebgui-keep-server-alive', (req, res) => {
	res.send()
});

server.listen(process.env.PORT || 9090, function() {
  var host = server.address().address
  var port = server.address().port
  console.log('App listening at http://%s:%s', host, port)
});

socketio.on('connection', function(socket) {
	console.log('Client connected to the WebSocket');

	socket.on('disconnect', () => {
		console.log('Client disconnected');
	});
	let results = undefined
	socket.on('generateImage', function(request) {
		console.log("Received a generateImage request");
		results = generateImage(request, socket)
		//.then((output) => {
		//	console.log("output is ready")
		//	socket.emit('generationResult', output);
		//	results = output
		//	return output
		//})
		while (results == undefined){
			console.log("waiting for output")
			//sleep 1 second
			setInterval(() => {
				console.log("waiting for output")
			}
			, 10000);
		}
		socket.emit('generationResult', results);
	});

	socket.on('message', function(message){
		// parse the message
		const { event, ...payload } = JSON.parse(message)
		// handle the event
		switch (event) {
			case 'chunk':
				// write the chunk to the file stream
				fileStream.write(Buffer.from(payload.blob, 'base64'))
				break

			case 'error':
				// log the error
				console.log('error:', payload.message)
				break

			case 'sid':
				let sid = sid()
				socket.send(JSON.stringify({
					event: 'sid',
					sid: sid
				}))
				break

			case 'generateImage':

				let request = {
					"prompt": "test",
					"iterations": 1,
					"steps": 50,
					"cfg_scale": 7.5,
					"threshold": 0,
					"perlin": 0,
					"height": 512,
					"width": 512,
					"sampler_name": "k_lms",
					"seed": 3263485805,
					"progress_images": false,
					"progress_latents": true,
					"save_intermediates": 5,
					"generation_mode": "unifiedCanvas",
					"init_mask": "data:image/png;base64,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CJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8g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oIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBB40W/6ahZLM0wAAAAASUVORK5CYII=",
					"fit": false,
					"strength": 0.75,
					"invert_mask": false,
					"bounding_box": {
					  "x": 0,
					  "y": 0,
					  "width": 512,
					  "height": 512
					},
					"init_img": "data:image/png;base64,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MACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAAEDwA8QIECAAIGggAEQLF1kAgQIECBgAPgBAgQIECAQFDAAgqWLTIAAAQIEDAA/QIAAAQIEggIGQLB0kQkQIECAgAHgBwgQIECAQFDAAAiWLjIBAgQIEDAA/AABAgQIEAgKGADB0kUmQIAAAQIGgB8gQIAAAQJBAQMgWLrIBAgQIEDAAPADBAgQIEAgKGAABEsXmQABAgQIGAB+gAABAgQIBAUMgGDpIhMgQIAAAQPADxAgQIAAgaCAARAsXWQCBAgQIGAA+AECBAgQIBAUMACCpYtMgAABAgQMAD9AgAABAgSCAgZAsHSRCRAgQICAAeAHCBAgQIBAUMAACJYuMgECBAgQMAD8AAECBAgQCAoYAMHSRSZAgAABAgaAHyBAgAABAkEBAyBYusgECBAgQMAA8AMECBAgQCAoYAAESxeZAAECBAgYAH6AAAECBAgEBQyAYOkiEyBAgAABA8APECBAgACBoIABECxdZAIECBAgYAD4AQIECBAgEBQwAIKli0yAAAECBAwAP0CAAAECBIICBkCwdJEJECBAgIAB4AcIECBAgEBQwAAIli4yAQIECBAwAPwAAQIECBAIChgAwdJFJkCAAAECBoAfIECAAAECQQEDIFi6yAQIECBAwADwAwQIECBAIChgAARLF5kAAQIECBgAfoAAAQIECAQFDIBg6SITIECAAIEH9IYCAbVe32sAAAAASUVORK5CYII=",
					"inpaint_width": 512,
					"inpaint_height": 512,
					"seam_size": 96,
					"seam_blur": 16,
					"seam_strength": 0.7,
					"seam_steps": 30,
					"tile_size": 32,
					"infill_method": "patchmatch",
					"force_outpaint": false,
					"variation_amount": 0
				}
				if (payload != undefined) {
					results = payload
					console.log(payload)
				}
				results = generateImage(sid, request)

				socket.send(JSON.stringify({
					event: 'sid',
					sid: sid
				}))
				break

			case 'requestImages':
				output = requestImages(user)
				socket.send(JSON.stringify({
					event: 'requestImages',
					output: output
				}))
				break

			case "requestModelChange":
				output = requestModelChange(user)
				socket.send(JSON.stringify({
					event: 'requestModelChange',
					output: output
				}))
				break

			case 'systemConfig':
				output = systemConfig()
				socket.send(JSON.stringify({
					event: 'systemConfig',
					output: output
				}))
				break

			case 'galleryImages':
				output = galleryImages(sid)
				socket.send(JSON.stringify({
					event: 'galleryImages',
					output: output
				}))
				break
			
			case 'generateImage':
				// close the file stream
				output= generateImage(sid)
				socket.send(JSON.stringify({
					event: 'generateImage',
					output: output
				}))

				break
			
			case 'progressUpdate':
				// close the file stream
				output= progressUpdate(sid)
				socket.send(JSON.stringify({
					event: 'progressUpdate',
					output: output
				}))
				break
			
			case 'intermediateResult':
				let output = intermediateResult(sid)
				socket.send(JSON.stringify({
					event: 'intermediateResult',
					output: output
				}))
				break
		}
	})
})